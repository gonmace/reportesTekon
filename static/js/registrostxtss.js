(function(){"use strict";function u(n,s={}){const r={...{pageSize:10,sortable:!0,searchable:!0},...s},t=document.querySelector(n);if(!t)throw new Error(`No se encontró el elemento con selector: ${n}`);return{element:t,options:r,data:[],currentPage:1,pageSize:r.pageSize,clear:function(){const o=this.element.querySelector("tbody");o&&(o.innerHTML="")},addRow:function(o){const i=this.element.querySelector("tbody");if(!i){const l=document.createElement("tbody");this.element.appendChild(l)}const c=document.createElement("tr");o.forEach(l=>{const g=document.createElement("td");g.innerHTML=l,c.appendChild(g)}),i.appendChild(c)},draw:function(){console.log("Tabla redibujada")}}}function d(n,s,a){n.clear(),s.forEach(r=>{const t=[];a.forEach(e=>{typeof e=="string"?t.push(r[e]):typeof e=="function"?t.push(e(r)):e.key&&t.push(e.render?e.render(r[e.key],r):r[e.key])}),n.addRow(t)}),n.draw()}function b(n,s,a,r={}){const e={...{showLoading:!0,onSuccess:null,onError:null},...r};e.showLoading&&showAlert("Cargando datos...","info"),fetch(s).then(o=>{if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return o.json()}).then(o=>{d(n,o,a),e.onSuccess&&e.onSuccess(o)}).catch(o=>{console.error("Error cargando datos:",o),e.onError?e.onError(o):showError("Error al cargar los datos. Por favor, inténtalo de nuevo.")})}function w(n,s){const a=[{key:"id",render:e=>`<strong>#${e}</strong>`},{key:"sitio",render:(e,o)=>{var i;return((i=o.sitio)==null?void 0:i.name)||"N/A"}},{key:"user",render:(e,o)=>{var i;return((i=o.user)==null?void 0:i.username)||"N/A"}},{key:"registro0",render:e=>e?'<span class="badge bg-success">Activo</span>':'<span class="badge bg-secondary">Inactivo</span>'},{key:"created_at",render:e=>new Date(e).toLocaleString("es-ES")},{key:"id",render:(e,o)=>`
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-outline-primary" 
                            onclick="editRegistro(${e})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-danger" 
                            onclick="deleteRegistro(${e})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `}],r=u(n);if(!r.element.querySelector("thead")){const e=document.createElement("thead"),o=document.createElement("tr");["ID","Sitio","Usuario","Estado","Fecha Creación","Acciones"].forEach(c=>{const l=document.createElement("th");l.textContent=c,o.appendChild(l)}),e.appendChild(o),r.element.appendChild(e)}return d(r,s,a),r}window.DataTableUtils={initializeDataTable:u,loadTableData:d,updateTableFromAPI:b,createRegistrosTable:w};function f(n,s="info",a={}){if(window.Alert&&typeof window.Alert.show=="function")return window.Alert.show(n,s,a);{const r={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"},t=r[s]||r.info;return alert(`${t} ${n}`),null}}function p(n,s={}){return f(n,"success",s)}function h(n,s={}){return f(n,"error",s)}document.addEventListener("DOMContentLoaded",function(){window.DataTableUtils&&window.DataTableUtils.createRegistrosTable?fetch("/api/v1/registros/").then(t=>t.json()).then(t=>{console.log("Datos recibidos:",t);const e=window.DataTableUtils.createRegistrosTable("#sitios-table",t);window.registrosTable=e}).catch(t=>{console.error("Error:",t),h("Error al cargar los registros. Por favor, inténtalo de nuevo.")}):(console.error("DataTableUtils no está disponible. Asegúrate de que datatable.js esté cargado."),fetch("/api/v1/registros/").then(t=>t.json()).then(t=>{console.log(t)}).catch(t=>{console.error("Error:",t)}));const n=document.getElementById("activar-registro-modal"),s=document.getElementById("activar-registro-btn");s&&n&&s.addEventListener("click",function(){console.log("activarBtn"),n.showModal()}),window.closeModal=function(){n.close()};const a=document.getElementById("activar-registro-btn");a&&a.addEventListener("click",function(){console.log("activarRegistroBtn")});const r=document.querySelector("#activar-registro-modal form");r&&r.addEventListener("submit",function(t){t.preventDefault();const e=new FormData(r),o={sitio_id:e.get("sitio"),user_id:e.get("user"),registro0:!1},i=document.querySelector("[name=csrfmiddlewaretoken]").value;fetch("/api/v1/registros/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":i},body:JSON.stringify(o)}).then(c=>{if(c.ok)return c.json();throw new Error("Error en la petición")}).then(c=>{console.log("Registro creado exitosamente:",c),n.close(),p("Registro creado exitosamente",{autoHide:5e3,dismissible:!0}),setTimeout(()=>{window.location.reload()},1e3)}).catch(c=>{console.error("Error:",c),h("Error al crear el registro. Por favor, inténtalo de nuevo.",{autoHide:0,dismissible:!0})})})})})();
