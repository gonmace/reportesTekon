{% extends "base.html" %}

{% load static %} 

{% block pre_content %}
    {% include 'components/common/breadcrumbs.html' %}
{% endblock pre_content %}

{% block content %}

<!-- Selector de fecha para mÃºltiples registros del mismo sitio -->
{% if registros_sitio|length > 1 %}
<div class="mb-6 p-4 bg-base-100 rounded-lg shadow-sm border sombra">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-2">
            <span class="text-sm font-medium text-base-content">Seleccionar fecha:</span>
        </div>
        <div class="flex items-center gap-2">
            <select id="fecha-selector" class="select select-bordered select-sm" onchange="cambiarRegistro(this.value)">
                {% for reg in registros_sitio %}
                    <option value="{{ reg.id }}" {% if reg.id == registro.id %}selected{% endif %}>
                        {{ reg.fecha|date:"d/m/Y" }} {% if reg.id == registro.id %}(Actual){% endif %}
                    </option>
                {% endfor %}
            </select>
            <a href="{% url app_namespace|add:':activar' %}" class="btn btn-primary btn-sm">
                <i class="fa-solid fa-plus"></i>
                Nueva Fecha
            </a>
        </div>
    </div>
</div>
{% endif %}

<ul class="timeline timeline-vertical">
    {% for step_name, step in steps %}
        {% include 'pages/step_generic.html' with step=step first=forloop.first last=forloop.last %}
    {% endfor %}
</ul>

<!-- Leyenda de colores -->
<div class="mt-8 p-4 bg-base-100 rounded-lg shadow-sm border sombra">
    <div class="flex justify-between flex-col md:flex-row items-center">

        <div class="flex flex-col w-full mb-2">
            <h3 class="font-bold">Leyenda de colores</h3>
            <!-- Error - Rojo -->
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 rounded-full bg-error"></div>
                <span class="text-sm text-base-content">Sin Datos</span>
            </div>
            
            <!-- Warning - Amarillo -->
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 rounded-full bg-warning"></div>
                <span class="text-sm text-base-content">Parciales</span>
            </div>
            
            <!-- Success - Verde -->
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 rounded-full bg-success"></div>
                <span class="text-sm text-base-content">Completos</span>
            </div>
        </div>

        <div class="flex flex-col w-full my-2 md:my-0 md:mb-auto">
        {% for step_name, step in steps %}
            {% if step.datos_clave_template %}
                    {% include step.datos_clave_template %}
            {% endif %}
        {% endfor %}
        </div>

        
    </div>
</div>

<script>
function cambiarRegistro(registroId) {
    if (registroId) {
        window.location.href = '/{{ app_namespace }}/' + registroId + '/';
    }
}
</script>
{% endblock %} 