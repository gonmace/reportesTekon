{% extends "base.html" %}
{% load static %}

{% block title %}Reportes de Construcción{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Breadcrumbs -->
    <div class="text-sm breadcrumbs mb-6">
        <ul>
            <li><a href="{% url 'dashboard:dashboard' %}" class="text-primary hover:text-primary-focus">Inicio</a></li>
            <li>Reportes de Construcción</li>
        </ul>
    </div>

    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <div>
            <h1 class="text-3xl font-bold text-base-content">
                <svg class="w-8 h-8 inline-block mr-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                </svg>
                Reportes de Construcción
            </h1>
            <p class="text-base-content/70 mt-2">
                Gestiona y visualiza todos tus reportes de construcción
            </p>
        </div>
        
        <div class="flex flex-wrap gap-2">
            <a href="{% url 'reg_construccion:dashboard' %}" class="btn btn-outline">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                Dashboard
            </a>
            <a href="{% url 'reg_construccion:create' %}" class="btn btn-primary">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Nuevo Reporte
            </a>
        </div>
    </div>

    <!-- Stats Summary -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-figure text-primary">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
            </div>
            <div class="stat-title">Total Reportes</div>
            <div class="stat-value text-primary">{{ registros.count }}</div>
        </div>
        
        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-figure text-success">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
            </div>
            <div class="stat-title">Este Mes</div>
            <div class="stat-value text-success">{{ registros.count }}</div>
        </div>
        
        <div class="stat bg-base-100 shadow rounded-lg">
            <div class="stat-figure text-info">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="stat-title">Última Actividad</div>
            <div class="stat-value text-info text-lg">
                {% if registros.first %}
                    {{ registros.first.created_at|date:"d/m" }}
                {% else %}
                    -
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <div class="form-control flex-1">
                    <div class="input-group">
                        <input type="text" placeholder="Buscar reportes..." class="input input-bordered w-full" id="searchInput">
                        <button class="btn btn-square btn-primary">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="flex gap-2">
                    <select class="select select-bordered">
                        <option value="">Todos los sitios</option>
                        <option value="sitio1">Sitio 1</option>
                        <option value="sitio2">Sitio 2</option>
                    </select>
                    
                    <select class="select select-bordered">
                        <option value="">Todos los estados</option>
                        <option value="completo">Completo</option>
                        <option value="en_progreso">En Progreso</option>
                        <option value="pendiente">Pendiente</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Reports Table -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body p-0">
            {% if registros %}
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr class="bg-base-200">
                                <th class="text-left">
                                    <label>
                                        <input type="checkbox" class="checkbox" id="selectAll">
                                    </label>
                                </th>
                                <th class="text-left">
                                    <div class="flex items-center gap-2">
                                        <span>ID</span>
                                        <svg class="w-4 h-4 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                                        </svg>
                                    </div>
                                </th>
                                <th class="text-left">Título</th>
                                <th class="text-left">Sitio</th>
                                <th class="text-left">Contratista</th>
                                <th class="text-left">Usuario</th>
                                <th class="text-left">Fecha</th>
                                <th class="text-left">Estado</th>
                                <th class="text-left">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for registro in registros %}
                            <tr class="hover:bg-base-200 transition-colors">
                                <td>
                                    <label>
                                        <input type="checkbox" class="checkbox registro-checkbox" value="{{ registro.id }}">
                                    </label>
                                </td>
                                <td class="font-mono text-sm">{{ registro.id }}</td>
                                <td>
                                    <div class="flex items-center space-x-3">
                                        <div class="avatar placeholder">
                                            <div class="bg-primary text-primary-content rounded-full w-8">
                                                <span class="text-xs">{{ registro.title|first|upper }}</span>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="font-bold">{{ registro.title }}</div>
                                            {% if registro.description %}
                                            <div class="text-sm opacity-50 line-clamp-1">{{ registro.description }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="badge badge-outline">
                                        {{ registro.sitio.name|default:"Sin sitio" }}
                                    </div>
                                </td>
                                <td>
                                    <div class="flex items-center space-x-2">
                                        <div class="badge badge-outline badge-primary" id="contratista-{{ registro.id }}">
                                            {{ registro.contratista.name|default:"Sin contratista" }}
                                        </div>
                                        <button class="btn btn-xs btn-ghost" onclick="editContratista({{ registro.id }}, '{{ registro.contratista.id|default:"" }}', '{{ registro.contratista.name|default:"" }}')" title="Editar contratista">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                                <td>
                                    <div class="flex items-center space-x-2">
                                        <div class="avatar placeholder">
                                            <div class="bg-neutral text-neutral-content rounded-full w-6">
                                                <span class="text-xs">{{ registro.user.username|first|upper }}</span>
                                            </div>
                                        </div>
                                        <span class="text-sm">{{ registro.user.username|default:"Sin usuario" }}</span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-sm">
                                        <div>{{ registro.created_at|date:"d/m/Y" }}</div>
                                        <div class="text-xs opacity-50">{{ registro.created_at|date:"H:i" }}</div>
                                    </div>
                                </td>
                                <td>
                                    {% if registro.avancecomponente_set.exists %}
                                        <div class="badge badge-success gap-1">
                                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            Completo
                                        </div>
                                    {% else %}
                                        <div class="badge badge-warning gap-1">
                                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" clip-rule="evenodd"></path>
                                            </svg>
                                            Pendiente
                                        </div>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="dropdown dropdown-end">
                                        <label tabindex="0" class="btn btn-ghost btn-sm">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
                                            </svg>
                                        </label>
                                        <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                                            <li>
                                                <a href="{% url 'reg_construccion:steps' registro.id %}" class="flex items-center">
                                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                                    </svg>
                                                    Ver Detalles
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{% url 'reg_construccion:update' registro.id %}" class="flex items-center">
                                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                                    </svg>
                                                    Editar
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{% url 'reg_construccion:pdf' registro.id %}" class="flex items-center">
                                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                    </svg>
                                                    Descargar PDF
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{% url 'reg_construccion:delete' registro.id %}" class="flex items-center text-error">
                                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                                    </svg>
                                                    Eliminar
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Bulk Actions -->
                <div class="p-4 border-t border-base-300">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <span class="text-sm text-base-content/70">
                                <span id="selectedCount">0</span> de {{ registros.count }} seleccionados
                            </span>
                            <div class="flex gap-2">
                                <button class="btn btn-sm btn-outline" id="bulkEdit" disabled>
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                    Editar Seleccionados
                                </button>
                                <button class="btn btn-sm btn-error btn-outline" id="bulkDelete" disabled>
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                    Eliminar Seleccionados
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-base-content/70">Mostrar:</span>
                            <select class="select select-bordered select-sm">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="text-center py-12">
                    <svg class="w-24 h-24 mx-auto text-base-content/30 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3 class="text-xl font-semibold text-base-content/70 mb-2">No hay reportes</h3>
                    <p class="text-base-content/50 mb-6">Aún no has creado ningún reporte de construcción</p>
                    <a href="{% url 'reg_construccion:create' %}" class="btn btn-primary">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Crear Primer Reporte
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Modal para editar contratista -->
<dialog id="editContratistaModal" class="modal">
    <div class="modal-box w-full sm:w-11/12 max-w-md bg-base-100 shadow-2xl">
        <!-- Header del modal -->
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-base-content">
                <svg class="w-6 h-6 inline mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                Editar Contratista
            </h3>
            <button class="btn btn-sm btn-circle btn-ghost" onclick="document.getElementById('editContratistaModal').close()">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <!-- Contenido del modal -->
        <div class="mb-6">
            <form id="editContratistaForm">
                <input type="hidden" id="registroId" name="registro_id">
                <div class="form-control">
                    <label for="contratistaSelect" class="label">
                        <span class="label-text font-medium">Contratista</span>
                    </label>
                    <select id="contratistaSelect" name="contratista_id" class="select select-bordered w-full">
                        <option value="">Sin contratista</option>
                        <!-- Las opciones se cargarán dinámicamente -->
                    </select>
                </div>
            </form>
        </div>
        
        <!-- Footer del modal -->
        <div class="modal-action">
            <div class="flex gap-2">
                <button class="btn btn-outline" onclick="document.getElementById('editContratistaModal').close()">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                    Cancelar
                </button>
                <button class="btn btn-primary" onclick="saveContratista()">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Guardar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Overlay para cerrar modal -->
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

{% block extra_js %}
<script>
// Variables globales para contratistas
let contratistas = [];

// Función para obtener CSRF token
function getCSRFToken() {
    const token = document.querySelector('[name=csrfmiddlewaretoken]');
    return token ? token.value : '';
}

// Función para cargar contratistas
async function loadContratistas() {
    try {
        const response = await fetch('/api/v1/contractors/', {
            method: 'GET',
            headers: {
                'X-CSRFToken': getCSRFToken(),
                'Accept': 'application/json'
            }
        });
        contratistas = await response.json();
    } catch (error) {
        console.error('Error al cargar contratistas:', error);
    }
}

// Función para editar contratista
function editContratista(registroId, contratistaId, contratistaName) {
    document.getElementById('registroId').value = registroId;
    
    const select = document.getElementById('contratistaSelect');
    select.innerHTML = '<option value="">Sin contratista</option>';
    
    // Agregar opciones de contratistas
    contratistas.forEach(contratista => {
        const option = document.createElement('option');
        option.value = contratista.id;
        option.textContent = `${contratista.name} (${contratista.code})`;
        if (contratista.id == contratistaId) {
            option.selected = true;
        }
        select.appendChild(option);
    });
    
    document.getElementById('editContratistaModal').showModal();
}

// Función para guardar contratista
async function saveContratista() {
    const registroId = document.getElementById('registroId').value;
    const contratistaId = document.getElementById('contratistaSelect').value;
    
    try {
        const response = await fetch(`/reg_construccion/${registroId}/update-contratista/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCSRFToken(),
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                contratista_id: contratistaId
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Actualizar la vista
            const contratistaElement = document.getElementById(`contratista-${registroId}`);
            if (contratistaId) {
                const contratista = contratistas.find(c => c.id == contratistaId);
                contratistaElement.textContent = contratista ? contratista.name : 'Sin contratista';
            } else {
                contratistaElement.textContent = 'Sin contratista';
            }
            
            document.getElementById('editContratistaModal').close();
            
            // Mostrar mensaje de éxito
            if (typeof window.showAlert === 'function') {
                window.showAlert('success', 'Contratista actualizado correctamente');
            } else {
                alert('Contratista actualizado correctamente');
            }
        } else {
            throw new Error(data.message || 'Error al actualizar contratista');
        }
    } catch (error) {
        console.error('Error:', error);
        if (typeof window.showAlert === 'function') {
            window.showAlert('error', 'Error al actualizar contratista');
        } else {
            alert('Error al actualizar contratista');
        }
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Cargar contratistas al inicio
    loadContratistas();
    
    // Search functionality
    const searchInput = document.getElementById('searchInput');
    const tableRows = document.querySelectorAll('tbody tr');
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        
        tableRows.forEach(row => {
            const text = row.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
    
    // Select all functionality
    const selectAllCheckbox = document.getElementById('selectAll');
    const registroCheckboxes = document.querySelectorAll('.registro-checkbox');
    const selectedCountSpan = document.getElementById('selectedCount');
    const bulkEditBtn = document.getElementById('bulkEdit');
    const bulkDeleteBtn = document.getElementById('bulkDelete');
    
    selectAllCheckbox.addEventListener('change', function() {
        registroCheckboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
        updateSelectedCount();
    });
    
    registroCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            updateSelectedCount();
            
            // Update select all checkbox
            const allChecked = Array.from(registroCheckboxes).every(cb => cb.checked);
            const someChecked = Array.from(registroCheckboxes).some(cb => cb.checked);
            
            selectAllCheckbox.checked = allChecked;
            selectAllCheckbox.indeterminate = someChecked && !allChecked;
        });
    });
    
    function updateSelectedCount() {
        const selectedCount = Array.from(registroCheckboxes).filter(cb => cb.checked).length;
        selectedCountSpan.textContent = selectedCount;
        
        bulkEditBtn.disabled = selectedCount === 0;
        bulkDeleteBtn.disabled = selectedCount === 0;
    }
    
    // Bulk delete confirmation
    bulkDeleteBtn.addEventListener('click', function() {
        const selectedCount = Array.from(registroCheckboxes).filter(cb => cb.checked).length;
        if (confirm(`¿Estás seguro de que quieres eliminar ${selectedCount} reporte(s)?`)) {
            // Implement bulk delete functionality
            console.log('Bulk delete would be implemented here');
        }
    });
});
</script>
{% endblock %}
{% endblock %}